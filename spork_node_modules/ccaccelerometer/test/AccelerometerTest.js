var AccelerometerTest = cc.Layer.extend({
    init : function(){
        this._super();
        winSize = cc.Director.getInstance().getWinSize();

        if( 'accelerometer' in sys.capabilities ) {
            // call is called 30 times per second
            this.setAccelerometerInterval(1/30);
            this.setAccelerometerEnabled(true);

            var sprite = this.sprite = cc.Sprite.create(res.r2_png);
            this.addChild( sprite );
            sprite.setPosition( winSize.width/2, winSize.height/2);

            // for low-pass filter
            this.prevX = 0;
            this.prevY = 0;
        } else {
            cc.log("ACCELEROMETER not supported");
        }
        return true;
    },
    onAccelerometer:function(accelEvent) {
        cc.log('Accel x: '+ accelEvent.x + ' y:' + accelEvent.y + ' z:' + accelEvent.z + ' time:' + accelEvent.timestamp );

        var w = winSize.width;
        var h = winSize.height;

        var x = w * accelEvent.x + w/2;
        var y = h * accelEvent.y + h/2;

        // Low pass filter
        x = x*0.2 + this.prevX*0.8;
        y = y*0.2 + this.prevY*0.8;

        this.prevX = x;
        this.prevY = y;
        this.sprite.setPosition( x, y );
    }
});
AccelerometerTest.create = function(args){
    var layer = new AccelerometerTest();
    layer.init();
    return layer;
}